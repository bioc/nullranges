<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Matching ranges: supported methods • nullranges</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Matching ranges: supported methods">
<meta property="og:description" content="nullranges">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nullranges</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction to nullranges</a>
    </li>
    <li>
      <a href="../articles/match_ranges.html">Matching ranges</a>
    </li>
    <li>
      <a href="../articles/match_ranges_methods.html">Matching ranges: supported methods</a>
    </li>
    <li>
      <a href="../articles/segmented_boot_ranges.html">Segmented block bootstrap</a>
    </li>
    <li>
      <a href="../articles/unseg_boot_ranges.html">Un-segmented block bootstrap</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nullranges/nullranges/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Matching ranges: supported methods</h1>
                        <h4 class="author">Eric S. Davis</h4>
            
            <h4 class="date">05/01/2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nullranges/nullranges/blob/master/vignettes/match_ranges_methods.Rmd"><code>vignettes/match_ranges_methods.Rmd</code></a></small>
      <div class="hidden name"><code>match_ranges_methods.Rmd</code></div>

    </div>

    
    
<p>This vignette demonstrates the supported matching methods (rejection sampling with replacement, nearest neighbor matching with replacement, and rejection sampling without replacement) when the covariates are either continuous, binary, categorical, or when the focal group is larger than the pool (bootstrapping).</p>
<p>First we load our data and add some additional annotations. In this case we add an indicator that shows whether or not our enhancers and promoters are looped (i.e. <code>loopedEP</code>), and we also break down the continuous <code>epDistance</code> into categorical groups (i.e. <code>epDistanceGrouped</code>).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nullranges/nullranges">nullranges</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">nullrangesData</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">plyranges</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">hictoolsr</span><span class="op">)</span>
<span class="co">#&gt; Error in library(hictoolsr): there is no package called 'hictoolsr'</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>

<span class="co">## Load enh-prom pairs (and shorten the name)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"enhPromContactFreqHg19"</span><span class="op">)</span>
<span class="va">epp</span> <span class="op">&lt;-</span> <span class="va">enhPromContactFreqHg19</span>

<span class="co">## Load loops</span>
<span class="va">loops</span> <span class="op">&lt;-</span> <span class="fu">fread</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/hic/MOMA_SIP_10kbLoops_Merged.txt"</span>,
                           package <span class="op">=</span> <span class="st">'nullrangesData'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">as_ginteractions</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Error in as_ginteractions(.): could not find function "as_ginteractions"</span>

<span class="co">## Annotate looped and unlooped enh-prom pairs</span>
<span class="va">epp</span><span class="op">$</span><span class="va">loopedEP</span> <span class="op">&lt;-</span> <span class="fl">0</span>
<span class="va">epp</span><span class="op">$</span><span class="va">loopedEP</span><span class="op">[</span><span class="fu">countOverlaps</span><span class="op">(</span><span class="va">epp</span>, <span class="va">loops</span><span class="op">)</span> <span class="op">&gt;</span><span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'subject' in selecting a method for function 'countOverlaps': object 'loops' not found</span>

<span class="co">## Cut enh-prom distance into groups</span>
<span class="va">epp</span><span class="op">$</span><span class="va">epDistanceGrouped</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="va">epp</span><span class="op">$</span><span class="va">epDistance</span>,
      breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fl">20e03</span>, <span class="fl">40e03</span>, <span class="fl">60e03</span>, <span class="fl">80e03</span>, <span class="cn">Inf</span><span class="op">)</span>,
      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0-20Kb"</span>, <span class="st">"20-40Kb"</span>, <span class="st">"40-60Kb"</span>, <span class="st">"60-80Kb"</span>, <span class="st">"80Kb-100Kb"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div id="continuous-covariate" class="section level2">
<h2 class="hasAnchor">
<a href="#continuous-covariate" class="anchor"></a>Continuous covariate</h2>
<p>Lets see how the matching methods perform when matching on a continuous covariate such as the enhancer-promoter distance (<code>epDistance</code>)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Define focal, pool and covar</span>
<span class="va">focal</span> <span class="op">&lt;-</span> <span class="va">epp</span><span class="op">[</span><span class="va">epp</span><span class="op">$</span><span class="va">loopedEP</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span>
<span class="va">pool</span>  <span class="op">&lt;-</span> <span class="va">epp</span><span class="op">[</span><span class="va">epp</span><span class="op">$</span><span class="va">loopedEP</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>
<span class="va">covar</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="va">epDistance</span>

<span class="co">## Implemented matching methods</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">mgi1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span><span class="va">focal</span>, <span class="va">pool</span>, <span class="va">covar</span>,
                      method <span class="op">=</span> <span class="st">'rejection'</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; Warning in speedglm(formula = f, data = covarData, family = binomial("logit"), :</span>
<span class="co">#&gt; Maximum number of iterations reached without convergence</span>
<span class="co">#&gt; Warning in min(x): no non-missing arguments to min; returning Inf</span>
<span class="co">#&gt; Warning in max(x): no non-missing arguments to max; returning -Inf</span>
<span class="co">#&gt; Error in seq.default(a, b, length = M): 'from' must be a finite number</span>
<span class="co">#&gt; Timing stopped at: 7.082 0.344 7.423</span>

<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">mgi2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span><span class="va">focal</span>, <span class="va">pool</span>, <span class="va">covar</span>,
                      method <span class="op">=</span> <span class="st">'nearest'</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; Warning in speedglm(formula = f, data = covarData, family = binomial("logit"), :</span>
<span class="co">#&gt; Maximum number of iterations reached without convergence</span>
<span class="co">#&gt; Error in sample.int(length(x), size, replace, prob): invalid 'size' argument</span>
<span class="co">#&gt; Timing stopped at: 6.636 0.188 6.777</span>

<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">mgi3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span><span class="va">focal</span>, <span class="va">pool</span>, <span class="va">covar</span>,
                      method <span class="op">=</span> <span class="st">'rejection'</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; Warning in speedglm(formula = f, data = covarData, family = binomial("logit"), :</span>
<span class="co">#&gt; Maximum number of iterations reached without convergence</span>
<span class="co">#&gt; Warning in min(x): no non-missing arguments to min; returning Inf</span>
<span class="co">#&gt; Warning in max(x): no non-missing arguments to max; returning -Inf</span>
<span class="co">#&gt; Error in seq.default(a, b, length = M): 'from' must be a finite number</span>
<span class="co">#&gt; Timing stopped at: 5.905 0.104 6.018</span>

<span class="co">## Should error (method not implemented)</span>
<span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span><span class="va">focal</span>, <span class="va">pool</span>, <span class="va">covar</span>,
            method <span class="op">=</span> <span class="st">'nearest'</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Error in matchRanges.Core(f, p, covar, method, replace): nearest neighbor matching without replacement not available.</span>


<span class="co">## Overviews for each method</span>
<span class="fu"><a href="../reference/overview.html">overview</a></span><span class="op">(</span><span class="va">mgi1</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'overview': object 'mgi1' not found</span>
<span class="fu"><a href="../reference/overview.html">overview</a></span><span class="op">(</span><span class="va">mgi2</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'overview': object 'mgi2' not found</span>
<span class="fu"><a href="../reference/overview.html">overview</a></span><span class="op">(</span><span class="va">mgi3</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'overview': object 'mgi3' not found</span>

<span class="co">## Number of duplicated samples</span>
<span class="va">n1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="fu"><a href="../reference/indices.html">indices</a></span><span class="op">(</span><span class="va">mgi1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'which': error in evaluating the argument 'x' in selecting a method for function 'duplicated': error in evaluating the argument 'x' in selecting a method for function 'indices': object 'mgi1' not found</span>
<span class="va">n2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="fu"><a href="../reference/indices.html">indices</a></span><span class="op">(</span><span class="va">mgi2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'which': error in evaluating the argument 'x' in selecting a method for function 'duplicated': error in evaluating the argument 'x' in selecting a method for function 'indices': object 'mgi2' not found</span>
<span class="va">n3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="fu"><a href="../reference/indices.html">indices</a></span><span class="op">(</span><span class="va">mgi3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'which': error in evaluating the argument 'x' in selecting a method for function 'duplicated': error in evaluating the argument 'x' in selecting a method for function 'indices': object 'mgi3' not found</span>

<span class="co">## Duplicated as a percentage of pool</span>
<span class="va">np1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">mgi1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'n1' not found</span>
<span class="va">np2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">mgi2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'n2' not found</span>
<span class="va">np3</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n3</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">mgi3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'n3' not found</span>

<span class="co">## Duplicated as a percentage of focal</span>
<span class="va">nf1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/focal.html">focal</a></span><span class="op">(</span><span class="va">mgi1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'n1' not found</span>
<span class="va">nf2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/focal.html">focal</a></span><span class="op">(</span><span class="va">mgi2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'n2' not found</span>
<span class="va">nf3</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n3</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/focal.html">focal</a></span><span class="op">(</span><span class="va">mgi3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'n3' not found</span>

<span class="co">## Plots for each</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mgi1</span>, type <span class="op">=</span> <span class="st">'lines'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">'Rejection matching with replacement'</span>,
          subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">'%s duplicates; %s%% of pool, %s%% of focal'</span>,
                             <span class="va">n1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">np1</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">nf1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'mgi1' not found</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mgi2</span>, type <span class="op">=</span> <span class="st">'lines'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">'Nearest matching with replacement'</span>,
          subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">'%s duplicates; %s%% of pool, %s%% of focal'</span>,
                             <span class="va">n2</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">np2</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">nf2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'mgi2' not found</span>
<span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mgi3</span>, type <span class="op">=</span> <span class="st">'lines'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">'Rejection matching without replacement'</span>,
          subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">'%s duplicates; %s%% of pool, %s%% of focal'</span>,
                             <span class="va">n3</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">np3</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">nf3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'mgi3' not found</span>

<span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> <span class="va">p3</span> <span class="op">+</span>
  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>
  title <span class="op">=</span> <span class="st">'Continuous covariate: looped vs. unlooped, covar = ~epDistance'</span>
  <span class="op">)</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'p1' not found</span></code></pre></div>
</div>
<div id="discrete-binary-covariate" class="section level2">
<h2 class="hasAnchor">
<a href="#discrete-binary-covariate" class="anchor"></a>Discrete (binary) covariate</h2>
<p>Lets see how the matching methods perform when matching on a discrete binary covariate such as whether the enhancer-promoter is looped or not (<code>loopedEP</code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Define focal, pool and covar</span>
<span class="va">focal</span> <span class="op">&lt;-</span> <span class="va">epp</span><span class="op">[</span><span class="va">epp</span><span class="op">$</span><span class="va">epDistance</span> <span class="op">&lt;=</span> <span class="fl">40e03</span><span class="op">]</span>
<span class="va">pool</span>  <span class="op">&lt;-</span> <span class="va">epp</span><span class="op">[</span><span class="va">epp</span><span class="op">$</span><span class="va">epDistance</span> <span class="op">&gt;</span> <span class="fl">40e03</span><span class="op">]</span>
<span class="va">covar</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="va">loopedEP</span>

<span class="co">## Convert to factor for overview()</span>
<span class="va">focal</span><span class="op">$</span><span class="va">loopedEP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">focal</span><span class="op">$</span><span class="va">loopedEP</span><span class="op">)</span>
<span class="va">pool</span><span class="op">$</span><span class="va">loopedEP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">pool</span><span class="op">$</span><span class="va">loopedEP</span><span class="op">)</span>

<span class="co">## Implemented matching methods</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">mgi1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span><span class="va">focal</span>, <span class="va">pool</span>, <span class="va">covar</span>,
                      method <span class="op">=</span> <span class="st">'rejection'</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels</span>
<span class="co">#&gt; Timing stopped at: 1.598 0 1.623</span>

<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">mgi2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span><span class="va">focal</span>, <span class="va">pool</span>, <span class="va">covar</span>,
                      method <span class="op">=</span> <span class="st">'nearest'</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels</span>
<span class="co">#&gt; Timing stopped at: 1.362 0 1.37</span>

<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">mgi3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span><span class="va">focal</span>, <span class="va">pool</span>, <span class="va">covar</span>,
                      method <span class="op">=</span> <span class="st">'rejection'</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels</span>
<span class="co">#&gt; Timing stopped at: 1.047 0 1.048</span>

<span class="co">## Should error (method not implemented)</span>
<span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span><span class="va">focal</span>, <span class="va">pool</span>, <span class="va">covar</span>,
            method <span class="op">=</span> <span class="st">'nearest'</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Error in matchRanges.Core(f, p, covar, method, replace): nearest neighbor matching without replacement not available.</span>


<span class="co">## Overviews for each method</span>
<span class="fu"><a href="../reference/overview.html">overview</a></span><span class="op">(</span><span class="va">mgi1</span><span class="op">)</span> <span class="co"># Rejection matching with replacement</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'overview': object 'mgi1' not found</span>
<span class="fu"><a href="../reference/overview.html">overview</a></span><span class="op">(</span><span class="va">mgi2</span><span class="op">)</span> <span class="co"># Nearest matching with replacement</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'overview': object 'mgi2' not found</span>
<span class="fu"><a href="../reference/overview.html">overview</a></span><span class="op">(</span><span class="va">mgi3</span><span class="op">)</span> <span class="co"># Rejection matching without replacement</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'overview': object 'mgi3' not found</span>

<span class="co">## Number of duplicated samples</span>
<span class="va">n1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="fu"><a href="../reference/indices.html">indices</a></span><span class="op">(</span><span class="va">mgi1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'which': error in evaluating the argument 'x' in selecting a method for function 'duplicated': error in evaluating the argument 'x' in selecting a method for function 'indices': object 'mgi1' not found</span>
<span class="va">n2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="fu"><a href="../reference/indices.html">indices</a></span><span class="op">(</span><span class="va">mgi2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'which': error in evaluating the argument 'x' in selecting a method for function 'duplicated': error in evaluating the argument 'x' in selecting a method for function 'indices': object 'mgi2' not found</span>
<span class="va">n3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="fu"><a href="../reference/indices.html">indices</a></span><span class="op">(</span><span class="va">mgi3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'which': error in evaluating the argument 'x' in selecting a method for function 'duplicated': error in evaluating the argument 'x' in selecting a method for function 'indices': object 'mgi3' not found</span>

<span class="co">## Duplicated as a percentage of pool</span>
<span class="va">np1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">mgi1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'n1' not found</span>
<span class="va">np2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">mgi2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'n2' not found</span>
<span class="va">np3</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n3</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">mgi3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'n3' not found</span>

<span class="co">## Duplicated as a percentage of focal</span>
<span class="va">nf1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/focal.html">focal</a></span><span class="op">(</span><span class="va">mgi1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'n1' not found</span>
<span class="va">nf2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/focal.html">focal</a></span><span class="op">(</span><span class="va">mgi2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'n2' not found</span>
<span class="va">nf3</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n3</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/focal.html">focal</a></span><span class="op">(</span><span class="va">mgi3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'n3' not found</span>

<span class="co">## Plots for each</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mgi1</span>, type <span class="op">=</span> <span class="st">'lines'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">'Rejection matching with replacement'</span>,
          subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">'%s duplicates; %s%% of pool, %s%% of focal'</span>,
                             <span class="va">n1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">np1</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">nf1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'mgi1' not found</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mgi2</span>, type <span class="op">=</span> <span class="st">'lines'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">'Nearest matching with replacement'</span>,
          subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">'%s duplicates; %s%% of pool, %s%% of focal'</span>,
                             <span class="va">n2</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">np2</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">nf2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'mgi2' not found</span>
<span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mgi3</span>, type <span class="op">=</span> <span class="st">'lines'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">'Rejection matching without replacement'</span>,
          subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">'%s duplicates; %s%% of pool, %s%% of focal'</span>,
                             <span class="va">n3</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">np3</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">nf3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'mgi3' not found</span>

<span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> <span class="va">p3</span> <span class="op">+</span>
  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">'Discrete (binary) covariate: small vs large epDistance, covar = ~loopedEP'</span>
  <span class="op">)</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'p1' not found</span></code></pre></div>
</div>
<div id="discrete-non-binary-covariate" class="section level2">
<h2 class="hasAnchor">
<a href="#discrete-non-binary-covariate" class="anchor"></a>Discrete (non-binary) covariate</h2>
<p>Lets see how the matching methods perform when matching on a discrete non-binary covariate (i.e. categorical covariate) such as which group the epDistance fall into (<code>epDistanceGrouped</code>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">## Define focal, pool and covar</span>
<span class="va">focal</span> <span class="op">&lt;-</span> <span class="va">epp</span><span class="op">[</span><span class="va">epp</span><span class="op">$</span><span class="va">loopedEP</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span>
<span class="va">pool</span>  <span class="op">&lt;-</span> <span class="va">epp</span><span class="op">[</span><span class="va">epp</span><span class="op">$</span><span class="va">loopedEP</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>
<span class="va">covar</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="va">epDistanceGrouped</span>

<span class="co">## Implemented matching methods</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">mgi1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span><span class="va">focal</span>, <span class="va">pool</span>, <span class="va">covar</span>,
                      method <span class="op">=</span> <span class="st">'rejection'</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; Warning in speedglm(formula = f, data = covarData, family = binomial("logit"), :</span>
<span class="co">#&gt; Maximum number of iterations reached without convergence</span>
<span class="co">#&gt; Warning in min(x): no non-missing arguments to min; returning Inf</span>
<span class="co">#&gt; Warning in max(x): no non-missing arguments to max; returning -Inf</span>
<span class="co">#&gt; Error in seq.default(a, b, length = M): 'from' must be a finite number</span>
<span class="co">#&gt; Timing stopped at: 7.162 0.12 7.281</span>

<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">mgi2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span><span class="va">focal</span>, <span class="va">pool</span>, <span class="va">covar</span>,
                      method <span class="op">=</span> <span class="st">'nearest'</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; Warning in speedglm(formula = f, data = covarData, family = binomial("logit"), :</span>
<span class="co">#&gt; Maximum number of iterations reached without convergence</span>
<span class="co">#&gt; Error in sample.int(length(x), size, replace, prob): invalid 'size' argument</span>
<span class="co">#&gt; Timing stopped at: 8.847 0.224 9.099</span>

<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">mgi3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span><span class="va">focal</span>, <span class="va">pool</span>, <span class="va">covar</span>,
                      method <span class="op">=</span> <span class="st">'rejection'</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; Warning in speedglm(formula = f, data = covarData, family = binomial("logit"), :</span>
<span class="co">#&gt; Maximum number of iterations reached without convergence</span>
<span class="co">#&gt; Warning in min(x): no non-missing arguments to min; returning Inf</span>
<span class="co">#&gt; Warning in max(x): no non-missing arguments to max; returning -Inf</span>
<span class="co">#&gt; Error in seq.default(a, b, length = M): 'from' must be a finite number</span>
<span class="co">#&gt; Timing stopped at: 8.884 0.2 9.095</span>

<span class="co">## Should error (method not implemented)</span>
<span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span><span class="va">focal</span>, <span class="va">pool</span>, <span class="va">covar</span>,
            method <span class="op">=</span> <span class="st">'nearest'</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Error in matchRanges.Core(f, p, covar, method, replace): nearest neighbor matching without replacement not available.</span>


<span class="co">## Overviews for each method</span>
<span class="fu"><a href="../reference/overview.html">overview</a></span><span class="op">(</span><span class="va">mgi1</span><span class="op">)</span> <span class="co"># Rejection matching with replacement</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'overview': object 'mgi1' not found</span>
<span class="fu"><a href="../reference/overview.html">overview</a></span><span class="op">(</span><span class="va">mgi2</span><span class="op">)</span> <span class="co"># Nearest matching with replacement</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'overview': object 'mgi2' not found</span>
<span class="fu"><a href="../reference/overview.html">overview</a></span><span class="op">(</span><span class="va">mgi3</span><span class="op">)</span> <span class="co"># Rejection matching without replacement</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'overview': object 'mgi3' not found</span>

<span class="co">## Number of duplicated samples</span>
<span class="va">n1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="fu"><a href="../reference/indices.html">indices</a></span><span class="op">(</span><span class="va">mgi1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'which': error in evaluating the argument 'x' in selecting a method for function 'duplicated': error in evaluating the argument 'x' in selecting a method for function 'indices': object 'mgi1' not found</span>
<span class="va">n2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="fu"><a href="../reference/indices.html">indices</a></span><span class="op">(</span><span class="va">mgi2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'which': error in evaluating the argument 'x' in selecting a method for function 'duplicated': error in evaluating the argument 'x' in selecting a method for function 'indices': object 'mgi2' not found</span>
<span class="va">n3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="fu"><a href="../reference/indices.html">indices</a></span><span class="op">(</span><span class="va">mgi3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'which': error in evaluating the argument 'x' in selecting a method for function 'duplicated': error in evaluating the argument 'x' in selecting a method for function 'indices': object 'mgi3' not found</span>

<span class="co">## Duplicated as a percentage of pool</span>
<span class="va">np1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">mgi1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'n1' not found</span>
<span class="va">np2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">mgi2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'n2' not found</span>
<span class="va">np3</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n3</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">mgi3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'n3' not found</span>

<span class="co">## Duplicated as a percentage of focal</span>
<span class="va">nf1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/focal.html">focal</a></span><span class="op">(</span><span class="va">mgi1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'n1' not found</span>
<span class="va">nf2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/focal.html">focal</a></span><span class="op">(</span><span class="va">mgi2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'n2' not found</span>
<span class="va">nf3</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">n3</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="../reference/focal.html">focal</a></span><span class="op">(</span><span class="va">mgi3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'n3' not found</span>

<span class="co">## Plots for each</span>
<span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mgi1</span>, type <span class="op">=</span> <span class="st">'lines'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">'Rejection matching with replacement'</span>,
          subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">'%s duplicates; %s%% of pool, %s%% of focal'</span>,
                             <span class="va">n1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">np1</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">nf1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'mgi1' not found</span>
<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mgi2</span>, type <span class="op">=</span> <span class="st">'lines'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">'Nearest matching with replacement'</span>,
          subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">'%s duplicates; %s%% of pool, %s%% of focal'</span>,
                             <span class="va">n2</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">np2</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">nf2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'mgi2' not found</span>
<span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mgi3</span>, type <span class="op">=</span> <span class="st">'lines'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">'Rejection matching without replacement'</span>,
          subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">'%s duplicates; %s%% of pool, %s%% of focal'</span>,
                             <span class="va">n3</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">np3</span>,<span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">signif</a></span><span class="op">(</span><span class="va">nf3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'mgi3' not found</span>

<span class="va">p1</span> <span class="op">+</span> <span class="va">p2</span> <span class="op">+</span> <span class="va">p3</span> <span class="op">+</span>
  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">'Discrete (non-binary) covariate: looped vs. unlooped, covar = ~epDistanceGrouped'</span>
  <span class="op">)</span>
<span class="co">#&gt; Error in eval(expr, envir, enclos): object 'p1' not found</span></code></pre></div>
</div>
<div id="case-where-focal-pool" class="section level2">
<h2 class="hasAnchor">
<a href="#case-where-focal-pool" class="anchor"></a>Case where focal &gt; pool</h2>
<p>Finally, lets see how the matching methods perform when the focal group is larger than the pool. In other words, which matching methods can bootstrap from a small pool.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Define focal, pool and covar</span>
<span class="va">focal</span> <span class="op">&lt;-</span> <span class="va">epp</span><span class="op">[</span><span class="va">epp</span><span class="op">$</span><span class="va">epDistance</span> <span class="op">&gt;=</span> <span class="fl">40e03</span><span class="op">]</span>
<span class="va">pool</span>  <span class="op">&lt;-</span> <span class="va">epp</span><span class="op">[</span><span class="va">epp</span><span class="op">$</span><span class="va">epDistance</span> <span class="op">&lt;</span>  <span class="fl">40e03</span><span class="op">]</span>
<span class="va">covar</span> <span class="op">=</span> <span class="op">~</span><span class="va">loopedEP</span> <span class="op">+</span> <span class="va">contactFreq</span>


<span class="co">## Implemented matching methods</span>

<span class="co">## Expect error</span>
<span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span><span class="va">focal</span>, <span class="va">pool</span>, <span class="va">covar</span>,
            method <span class="op">=</span> <span class="st">'rejection'</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Warning in predict.speedlm(rval, newdata = M): prediction from a rank-deficient</span>
<span class="co">#&gt; fit may be misleading</span>
<span class="co">#&gt; Error in rejectSample(nfps, npps): focal must be &lt;= pool for method = 'rejection'.</span>

<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">mgi2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span><span class="va">focal</span>, <span class="va">pool</span>, <span class="va">covar</span>,
                      method <span class="op">=</span> <span class="st">'nearest'</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; Warning in predict.speedlm(rval, newdata = M): prediction from a rank-deficient</span>
<span class="co">#&gt; fit may be misleading</span>
<span class="co">#&gt;    user  system elapsed </span>
<span class="co">#&gt;   4.262   0.052   4.126</span>

<span class="co">## Expect error</span>
<span class="va">mgi3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span><span class="va">focal</span>, <span class="va">pool</span>, <span class="va">covar</span>,
                    method <span class="op">=</span> <span class="st">'rejection'</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Error in matchRanges.Core(f, p, covar, method, replace): focal must be &lt;= pool when replace = FALSE.</span>

<span class="co">## Expect error (method not implemented)</span>
<span class="fu"><a href="../reference/matchRanges.html">matchRanges</a></span><span class="op">(</span><span class="va">focal</span>, <span class="va">pool</span>, <span class="va">covar</span>,
            method <span class="op">=</span> <span class="st">'nearest'</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; Error in matchRanges.Core(f, p, covar, method, replace): focal must be &lt;= pool when replace = FALSE.</span>


<span class="co">## Overviews for each method</span>
<span class="fu"><a href="../reference/overview.html">overview</a></span><span class="op">(</span><span class="va">mgi2</span><span class="op">)</span> <span class="co"># Nearest matching with replacement</span>
<span class="co">#&gt; MatchedGInteractions object: </span>
<span class="co">#&gt;      group       N loopedEP.mean loopedEP.sd contactFreq.mean contactFreq.sd</span>
<span class="co">#&gt;      focal 1199205             0           0         194.1452       595.9882</span>
<span class="co">#&gt;    matched 1199205             0           0         194.1343       595.7753</span>
<span class="co">#&gt;       pool   56946             0           0         758.9511      3307.8538</span>
<span class="co">#&gt;  unmatched    1898             0           0       11304.4810     13462.9692</span>
<span class="co">#&gt;    ps.mean      ps.sd</span>
<span class="co">#&gt;  0.9554415 0.01984558</span>
<span class="co">#&gt;  0.9554417 0.01984161</span>
<span class="co">#&gt;  0.9383411 0.10110572</span>
<span class="co">#&gt;  0.5820795 0.36386648</span>
<span class="co">#&gt; --------</span>
<span class="co">#&gt; focal - matched: </span>
<span class="co">#&gt;  loopedEP.mean loopedEP.sd contactFreq.mean contactFreq.sd       ps.mean</span>
<span class="co">#&gt;              0           0       0.01091223       1.595324 -2.387263e-07</span>
<span class="co">#&gt;         ps.sd</span>
<span class="co">#&gt;  4.194007e-05</span>

<span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mgi2</span>, type <span class="op">=</span> <span class="st">'ridge'</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">'Nearest matching with replacement (bootstrapping)'</span><span class="op">)</span>
<span class="co">#&gt; Picking joint bandwidth of 0.0182</span></code></pre></div>
<p><img src="match_ranges_methods_files/figure-html/focal-gt-pool-1.png"><!-- --></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://mikelove.github.io">Michael Love</a>, <a href="https://twitter.com/wancenm">Wancen Mu</a>, Eric Davis, <a href="http://phanstiel-lab.med.unc.edu">Douglas Phanstiel</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
