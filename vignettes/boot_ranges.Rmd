---
title: "Toy data bootstrap ranges"
author: "Michael Love"
date: "`r format(Sys.Date(), '%m/%d/%Y')`"
output:
  rmarkdown::html_document:
    highlight: tango
vignette: |
  %\VignetteIndexEntry{Toy data bootstrap ranges}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r}
library(AnnotationHub)
ah <- AnnotationHub()
pks <- query(ah, c("DnaseSeq", "narrowPeak", "A549", "UniPk"))[[1]]
```

```{r}
library(GenomeInfoDb)
pks <- keepStandardChromosomes(pks)
seqlevels(pks) <- setdiff(seqlevels(pks), "chrM")
table(seqnames(pks))
pks <- sort(pks)
```

Evaluate times:

```{r}
library(microbenchmark)
microbenchmark(list=alist(
                 p_within=bootstrap_granges(pks, L_b=5e5, type="permute"),
                 b_within=bootstrap_granges(pks, L_b=5e5),
                 p_across=bootstrap_granges(pks, L_b=5e5, within_chrom=FALSE, type="permute"),
                 b_across=bootstrap_granges(pks, L_b=5e5, within_chrom=FALSE)
), times=10)
```

# Visualize boot on synthetic data

```{r}
library(nullranges)
```

```{r}
library(GenomicRanges)
gr <- GRanges(rep(c("chr1","chr2","chr3"),c(4,5,2)),
              IRanges(start=c(1,101,121,201,101,201,216,231,401,1 ,101),
                      width=c(20, 5,  5, 30, 20,  5,  5,  5, 30,80,80)),
              seqlengths=c(chr1=300,chr2=450,chr3=200))
```

```{r}
library(ggbio)
ggbio::autoplot(gr)
```

```{r}
for (s in 1:5) {
  set.seed(s)
  gr_prime <- bootstrap_granges(gr, L_b=100, type="permute")
  print(ggbio::autoplot(gr_prime))
}
```

```{r}
for (s in 1:5) {
  set.seed(s)
  gr_prime <- bootstrap_granges(gr, L_b=100)
  print(ggbio::autoplot(gr_prime))
}
```

# Now across chroms:

Simple case, move fixed blocks around:

```{r}
for (s in 1:5) {
  set.seed(s)
  gr_prime <- bootstrap_granges(gr, L_b=200, type="permute", within_chrom=FALSE)
  print(ggbio::autoplot(gr_prime))
}
```

Now, randomly placed blocks with replacement (default `type="bootstap"`):

```{r}
for (s in 1:5) {
  set.seed(s)
  gr_prime <- bootstrap_granges(gr, L_b=200, within_chrom=FALSE)
  print(ggbio::autoplot(gr_prime))
}
```
