---
title: "Matching ranges"
author: "Eric S. Davis"
date: "`r format(Sys.Date(), '%m/%d/%Y')`"
output:
  rmarkdown::html_document:
    highlight: tango
    toc: true
    toc_float: true	
    fig_width: 5
    fig_height: 3
vignette: |
  %\VignetteIndexEntry{Matching ranges}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r}
library(nullranges)
library(magrittr)
```

Test data

```{r}
library(nullrangesData)
data("enhPromContactFreqHg19")
```

Define parameters

```{r}
set.seed(123)
s <- sample(1:length(enhPromContactFreqHg19), 6000)
x <- enhPromContactFreqHg19[head(s, 1000)]
u <- enhPromContactFreqHg19[tail(s, 5000)]
covar <- ~ anchor1.peakStrength + contactFreq
```

Match GInteractions object

```{r}
mgi <- matchRanges(focal = x, pool = u, covar = covar,
                   method = 'nearest', replace = TRUE)
```

Prints and behaves like a normal GInteractions object

```{r}
mgi
```

Visualize matching

```{r vis-match}
plotPropensity(mgi) #plot shows propensity scores
plotPropensity(mgi, type = 'ridge')
plotCovariate(mgi, covar = 'contactFreq', type = 'ridge', log = 'x')
plotCovariate(mgi, covar = 'contactFreq', type = 'jitter', log = 'x')
plotCovariate(mgi, covar = 'contactFreq', type = 'jitter', log = 'x')
```

Summary and access data

```{r}
overview(mgi)
matchedData(mgi) %>% head()
covariates(mgi)
```

Get each type of result as GInteractions objects

```{r}
focal(mgi)
pool(mgi)
matched(mgi)
unmatched(mgi)
```

Extract indices by set (default is 'matched')

```{r}
indices(mgi, set = "unmatched") %>% head()
indices(mgi) %>% head()
```

Should be `TRUE`:

```{r}
identical(matchedData(mgi)[set == "pool"][indices(mgi, set = "unmatched"), -c('set')],
          matchedData(mgi)[set == "unmatched", -c('set')])
```
